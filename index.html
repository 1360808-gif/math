<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ã‚ã¾ã‚Šã®ã‚ã‚‹ã‚ã‚Šç®—ãƒ—ãƒªãƒ³ãƒˆï¼ˆ3å¹´ç”Ÿï¼‰</title>
  <style>
    :root{
      --bg:#f7f8ff;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --line:#e5e7eb;
      --good:#16a34a;
      --bad:#dc2626;
      --accent:#4f46e5;
      --accent2:#06b6d4;
      --shadow: 0 10px 24px rgba(0,0,0,.08);
      --radius: 18px;
    }
    *{ box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
      background: radial-gradient(900px 500px at 10% 0%, #e9f2ff 0%, transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, #e7fff9 0%, transparent 55%),
                  var(--bg);
      color: var(--ink);
      line-height: 1.6;
    }
    .wrap{ max-width: 980px; margin: 18px auto; padding: 0 14px 40px; }

    .top{
      background: linear-gradient(135deg, #ffffff 0%, #f4f7ff 45%, #ecfeff 100%);
      border: 1px solid var(--line);
      border-radius: calc(var(--radius) + 6px);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      position: sticky;
      top: 10px;
      z-index: 5;
      backdrop-filter: blur(6px);
    }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .spacer{ flex:1; min-width: 120px; }

    h1{
      margin: 2px 0 8px;
      font-size: 22px;
      letter-spacing: .02em;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .badge{
      font-size: 12px;
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      padding: 4px 10px;
      border-radius: 999px;
      color: #3730a3;
      font-weight: 800;
    }

    .controls button{
      border: 0;
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 900;
      letter-spacing: .02em;
      cursor: pointer;
      box-shadow: 0 6px 14px rgba(79,70,229,.14);
      background: var(--accent);
      color: #fff;
    }
    .controls button.secondary{
      background: #ffffff;
      color: var(--ink);
      border: 1px solid var(--line);
      box-shadow: none;
    }
    .controls button:active{ transform: translateY(1px); }

    .hint{ color: var(--muted); font-size: 13px; font-weight: 800; }
    .meta{
      margin-top: 10px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      color: var(--muted);
      font-weight: 800;
    }

    .panel{
      margin-top: 14px;
      display: grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 12px;
    }
    @media (max-width: 860px){
      .panel{ grid-template-columns: 1fr; }
      .top{ position: static; }
    }
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
    }

    /* ===== ã­ã“ã‚¨ãƒªã‚¢ ===== */
    .mascotRow{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .mascot{
      display:flex;
      align-items:flex-end;
      gap: 10px;
      flex: 1;
      min-width: 260px;
    }
    .cat{
      width: 62px;
      height: 62px;
      border-radius: 18px;
      background: #fff;
      border: 1px solid var(--line);
      box-shadow: 0 8px 16px rgba(0,0,0,.07);
      display:grid;
      place-items:center;
      font-size: 34px;
      user-select: none;
    }
    .bubble{
      position: relative;
      background: #ffffff;
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 10px 18px rgba(0,0,0,.05);
      font-weight: 900;
      color: var(--ink);
      flex: 1;
      min-width: 200px;
    }
    .bubble::before{
      content:"";
      position:absolute;
      left:-8px;
      bottom: 18px;
      width: 16px;
      height: 16px;
      background: #fff;
      border-left: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
      transform: rotate(45deg);
    }
    .bubble small{
      display:block;
      margin-top: 4px;
      color: var(--muted);
      font-weight: 800;
      font-size: 12px;
    }

    /* ===== é€²ã¿/ç‚¹æ•° ===== */
    .progressBox{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .bar{
      flex:1;
      min-width: 220px;
      height: 12px;
      background: #eef2ff;
      border: 1px solid #dbeafe;
      border-radius: 999px;
      overflow: hidden;
    }
    .bar > div{
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      transition: width .25s ease;
    }
    .score{ font-weight: 1000; font-size: 16px; }
    .praise{
      font-weight: 1000;
      padding: 8px 10px;
      border-radius: 14px;
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      color: #14532d;
      display:none;
    }

    /* ===== è¨­å®š ===== */
    .settings{ display:flex; gap:10px; align-items:end; flex-wrap:wrap; }
    label{
      display:flex;
      flex-direction: column;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    select, input[type="number"]{
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--line);
      font-size: 16px;
      background: #fff;
      color: var(--ink);
      width: 140px;
    }

    /* ===== å•é¡Œã‚«ãƒ¼ãƒ‰ ===== */
    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 720px){
      .grid{ grid-template-columns: 1fr; }
    }

    .q{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: #fff;
      padding: 12px;
      box-shadow: 0 10px 18px rgba(0,0,0,.05);
      position: relative;
    }
    .qHeader{
      display:flex; align-items:center; justify-content: space-between;
      margin-bottom: 6px;
      gap: 10px;
    }
    .num{
      font-weight: 1000;
      background: #ecfeff;
      border: 1px solid #a5f3fc;
      color: #155e75;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      flex: none;
    }
    .status{
      font-size: 12px;
      color: var(--muted);
      font-weight: 1000;
      flex: none;
    }

    .expr{
      font-size: 20px;
      font-weight: 1000;
      letter-spacing: .02em;
      display:flex;
      align-items:center;
      flex-wrap:wrap;
      gap: 8px;
    }

    .ans{
      display:flex;
      align-items:center;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
      color: var(--muted);
      font-weight: 1000;
    }
    .ans input{
      width: 88px;
      font-size: 18px;
      font-weight: 1000;
      text-align: center;
      padding: 10px 8px;
      border-radius: 14px;
      border: 2px solid #e5e7eb;
      outline: none;
    }
    .ans input:focus{
      border-color: #93c5fd;
      box-shadow: 0 0 0 4px rgba(59,130,246,.15);
    }

    .ok{ background: #f0fdf4; border-color: #bbf7d0; }
    .ng{ background: #fff1f2; border-color: #fecdd3; }
    .ok .status{ color: var(--good); }
    .ng .status{ color: var(--bad); }

    .answers{
      margin-top: 12px;
      display:none;
      border-top: 2px dashed #cbd5e1;
      padding-top: 12px;
    }
    .answers h2{ margin: 0 0 8px; font-size: 18px; }
    .ansList{ columns: 2; column-gap: 18px; }
    @media (max-width: 720px){ .ansList{ columns: 1; } }
    .ansList div{ break-inside: avoid; margin: 0 0 6px; color: var(--muted); font-weight: 900; }

    /* ===== ç´™å¹é›ª ===== */
    .confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      display:none;
    }
    .confetti i{
      position:absolute;
      top:-10px;
      width:10px; height:10px;
      border-radius: 2px;
      animation: fall 900ms linear forwards;
      opacity:.9;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); }
    }

    @media print{
      body{ background:#fff; }
      .top, .panel .card:last-child, .confetti, .mascotRow{ display:none !important; }
      .wrap{ max-width: none; margin: 0; padding: 0; }
      .card{ box-shadow:none; border:none; }
      .q{ break-inside: avoid; box-shadow:none; }
      .answers{ display:block !important; }
    }
  </style>
</head>

<body>
  <div class="confetti" id="confetti"></div>

  <div class="wrap">
    <div class="top">
      <div class="row" style="justify-content: space-between;">
        <h1>
          ã‚ã¾ã‚Šã®ã‚ã‚‹ ã‚ã‚Šç®—
          <span class="badge">3å¹´ç”Ÿå‘ã‘</span>
        </h1>
        <div class="controls row">
          <button id="makeBtn">ã‚‚ã‚“ã ã„ ã‚’ ã¤ãã‚‹</button>
          <button class="secondary" id="checkBtn">ã“ãŸãˆã‚ã‚ã›</button>
          <button class="secondary" id="toggleAnsBtn">ã“ãŸãˆ ã‚’ ã¿ã‚‹</button>
          <button class="secondary" id="printBtn">ã„ã‚“ã•ã¤</button>
        </div>
      </div>

      <div class="row">
        <div class="hint">ğŸ’¡ã€Œã—ã‚‡ã†ã€ã¨ã€Œã‚ã¾ã‚Šã€ã‚’å…¥ã‚Œã¦ã­ï¼ˆæ•°å­—ã¯åŠè§’ï¼‰</div>
        <div class="spacer"></div>
        <div class="meta">
          <div>å¹´ï¼š_____ã€€çµ„ï¼š_____</div>
          <div>åå‰ï¼š________________</div>
        </div>
      </div>

      <!-- ã­ã“å¿œæ´ -->
      <div class="mascotRow">
        <div class="mascot">
          <div class="cat" id="catFace" aria-label="ã‚ã‚Šç®—ã­ã“">ğŸ±</div>
          <div class="bubble" id="catBubble">
            ã‚ˆãƒ¼ã—ï¼ã„ã£ã—ã‚‡ã« ãŒã‚“ã°ã‚ã†ï¼
            <small id="catSub">ï¼ˆEnterã§ã¤ãã«ã™ã™ã‚€ã‚ˆï¼‰</small>
          </div>
        </div>
        <div class="hint" id="timer" style="font-weight:1000;">â± 0:00</div>
      </div>
    </div>

    <div class="panel">
      <div class="card">
        <div class="progressBox">
          <div class="score" id="score">ç‚¹æ•°ï¼šâ€” / 100</div>
          <div class="bar" aria-label="é€²ã¿ãã‚ã„"><div id="barFill"></div></div>
          <div class="hint" id="progressText">é€²ã¿ï¼š0 / 20</div>
          <div class="praise" id="praise">ã™ã”ã„ï¼</div>
        </div>
      </div>

      <div class="card">
        <div class="settings">
          <label>
            ã‚‚ã‚“ã ã„æ•°
            <select id="countSel">
              <option value="10">10ã‚‚ã‚“</option>
              <option value="15">15ã‚‚ã‚“</option>
              <option value="20" selected>20ã‚‚ã‚“</option>
              <option value="30">30ã‚‚ã‚“</option>
            </select>
          </label>

          <label>
            ã‚ã‚‹æ•°ï¼ˆÃ·ï¼‰
            <select id="divSel">
              <option value="2-5">2ã€œ5</option>
              <option value="2-9" selected>2ã€œ9</option>
            </select>
          </label>

          <label>
            ã—ã‚‡ã†ã®å¤§ãã•
            <select id="qSel">
              <option value="2-6">2ã€œ6</option>
              <option value="2-9" selected>2ã€œ9</option>
              <option value="3-9">3ã€œ9</option>
            </select>
          </label>

          <label>
            ã‚¿ã‚¤ãƒãƒ¼
            <select id="speedSel">
              <option value="off" selected>ã‚ªãƒ•</option>
              <option value="on">ON</option>
            </select>
          </label>
        </div>
        <div class="hint" style="margin-top:10px;">ğŸ¾ ã‚€ãšã‹ã—ã„ã¨ãã¯ã€Œã‚ã‚‹æ•°ã€ã‚’2ã€œ5ã«ã—ã¦ã­</div>
      </div>
    </div>

    <div class="grid" id="qs"></div>

    <div class="card answers" id="answers">
      <h2>ã€ã‹ã„ã¨ã†ã€‘</h2>
      <div class="ansList" id="ansList"></div>
    </div>
  </div>

<script>
  let problems = [];
  let QUESTION_COUNT = 20;
  let DIV_MIN = 2, DIV_MAX = 9;
  let Q_MIN = 2, Q_MAX = 9;

  const elQs = document.getElementById("qs");
  const elScore = document.getElementById("score");
  const elAnswers = document.getElementById("answers");
  const elAnsList = document.getElementById("ansList");
  const elBar = document.getElementById("barFill");
  const elProg = document.getElementById("progressText");
  const elPraise = document.getElementById("praise");
  const elConfetti = document.getElementById("confetti");

  // ã­ã“
  const catFace = document.getElementById("catFace");
  const catBubble = document.getElementById("catBubble");
  const catSub = document.getElementById("catSub");

  const countSel = document.getElementById("countSel");
  const divSel = document.getElementById("divSel");
  const qSel = document.getElementById("qSel");
  const speedSel = document.getElementById("speedSel");
  const timerEl = document.getElementById("timer");

  let timerId = null;
  let startAt = null;

  function randInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }

  function parseRange(str){
    const [a,b] = str.split("-").map(Number);
    return {min:a, max:b};
  }

  function applySettings(){
    QUESTION_COUNT = Number(countSel.value);
    const d = parseRange(divSel.value); DIV_MIN = d.min; DIV_MAX = d.max;
    const q = parseRange(qSel.value);   Q_MIN = q.min; Q_MAX = q.max;
  }

  function generateProblems() {
    const set = new Set();
    const out = [];
    while (out.length < QUESTION_COUNT) {
      const b = randInt(DIV_MIN, DIV_MAX);
      const q = randInt(Q_MIN, Q_MAX);
      const r = randInt(1, b - 1);   // ã‚ã¾ã‚Šã¯å¿…ãšã‚ã‚‹
      const a = b * q + r;
      const key = `${a}/${b}`;
      if (set.has(key)) continue;
      set.add(key);
      out.push({ a, b, q, r });
    }
    return out;
  }

  function formatTime(ms){
    const sec = Math.floor(ms/1000);
    const m = Math.floor(sec/60);
    const s = sec%60;
    return `${m}:${String(s).padStart(2,"0")}`;
  }

  function startTimer(){
    stopTimer();
    startAt = Date.now();
    timerEl.textContent = `â± 0:00`;
    if (speedSel.value === "on") {
      timerId = setInterval(() => {
        timerEl.textContent = `â± ${formatTime(Date.now()-startAt)}`;
      }, 250);
    }
  }
  function stopTimer(){ if (timerId) clearInterval(timerId); timerId = null; }

  // ===== ã­ã“ã®ã‚»ãƒªãƒ•ç®¡ç† =====
  const CAT = {
    idle:  {face:"ğŸ±", text:"ã‚ˆãƒ¼ã—ï¼ã„ã£ã—ã‚‡ã« ãŒã‚“ã°ã‚ã†ï¼", sub:"ï¼ˆEnterã§ã¤ãã¸ï¼‰"},
    start: {face:"ğŸ˜º", text:"ã‚¹ã‚¿ãƒ¼ãƒˆï¼ã‚ã‚ã¦ãš ã¦ã„ã­ã„ã«ã­ï¼", sub:""},
    mid:   {face:"ğŸ˜¼", text:"ã„ã„ãƒšãƒ¼ã‚¹ï¼ã“ã®ã¡ã‚‡ã†ã—ï¼", sub:""},
    near:  {face:"ğŸ˜¸", text:"ã‚ã¨ã™ã“ã—ï¼ã•ã„ã”ã¾ã§ ã„ã‘ã‚‹ï¼", sub:""},
    all:   {face:"ğŸ˜»", text:"ãœã‚“ã¶ ã†ã¾ã£ãŸï¼ã“ãŸãˆã‚ã‚ã› ã—ã¦ã¿ã‚ˆï¼", sub:""},
    low:   {face:"ğŸ±", text:"ã ã„ã˜ã‚‡ã†ã¶ï¼ã¾ã¡ãŒã„ã¯ ã®ã³ã—ã‚ï¼", sub:"ã‚‚ã†ã„ã¡ã© ã‚„ã£ã¦ã¿ã‚ˆã†"},
    midScore:{face:"ğŸ˜º", text:"ã„ã„ã­ï¼ã¾ã¡ãŒã„ã‚’ ãªãŠã›ã° ã‚‚ã£ã¨ã„ã‘ã‚‹ï¼", sub:""},
    high:  {face:"ğŸ˜¸", text:"ã™ã”ã„ï¼ã»ã¨ã‚“ã© ã§ãã¦ã‚‹ï¼", sub:""},
    perfect:{face:"ğŸ˜»", text:"ã‹ã‚“ãºãï¼ï¼ãœã‚“ã¶ ã›ã„ã‹ã„ï¼ï¼", sub:""}
  };

  function setCat(mode){
    catFace.textContent = mode.face;
    catBubble.firstChild.nodeValue = mode.text;
    catSub.textContent = mode.sub || "";
  }

  function updateProgress(){
    const inputsQ = Array.from(document.querySelectorAll(".ansQ"));
    const inputsR = Array.from(document.querySelectorAll(".ansR"));

    let filled = 0;
    for(let i=0;i<QUESTION_COUNT;i++){
      const hasQ = inputsQ[i]?.value !== "";
      const hasR = inputsR[i]?.value !== "";
      if (hasQ && hasR) filled++;
    }
    elProg.textContent = `é€²ã¿ï¼š${filled} / ${QUESTION_COUNT}`;
    const pct = Math.round((filled/QUESTION_COUNT)*100);
    elBar.style.width = `${pct}%`;

    // ã­ã“ã®åŠ±ã¾ã—ï¼ˆé€²ã¿ãã‚ã„ï¼‰
    if (filled === 0) setCat(CAT.start);
    else if (filled < Math.ceil(QUESTION_COUNT*0.5)) setCat(CAT.start);
    else if (filled < Math.ceil(QUESTION_COUNT*0.85)) setCat(CAT.mid);
    else if (filled < QUESTION_COUNT) setCat(CAT.near);
    else setCat(CAT.all);
  }

  function setPraise(text, show=true){
    elPraise.textContent = text;
    elPraise.style.display = show ? "inline-block" : "none";
  }

  function popConfetti(){
    elConfetti.innerHTML = "";
    elConfetti.style.display = "block";
    const colors = ["#4f46e5","#06b6d4","#22c55e","#f59e0b","#ef4444"];
    const n = 60;
    for(let i=0;i<n;i++){
      const p = document.createElement("i");
      const left = Math.random()*100;
      const delay = Math.random()*150;
      const size = 6 + Math.random()*8;
      p.style.left = left + "vw";
      p.style.animationDelay = delay + "ms";
      p.style.width = size + "px";
      p.style.height = size + "px";
      p.style.background = colors[Math.floor(Math.random()*colors.length)];
      elConfetti.appendChild(p);
    }
    setTimeout(()=>{ elConfetti.style.display="none"; }, 1000);
  }

  function render() {
    elQs.innerHTML = "";
    problems.forEach((p, i) => {
      const div = document.createElement("div");
      div.className = "q";
      div.innerHTML = `
        <div class="qHeader">
          <span class="num">${i + 1} ã‚‚ã‚“ã‚</span>
          <span class="status">ã¾ã </span>
        </div>

        <div class="expr">
          ${p.a} Ã· ${p.b} ï¼
        </div>

        <div class="ans">
          ã—ã‚‡ã†
          <input type="number" inputmode="numeric" min="0" class="ansQ" aria-label="å•† ${i+1}">
          ã‚ã¾ã‚Š
          <input type="number" inputmode="numeric" min="0" class="ansR" aria-label="ã‚ã¾ã‚Š ${i+1}">
        </div>
      `;
      elQs.appendChild(div);
    });

    elAnsList.innerHTML = problems.map((p, i) =>
      `<div>${i + 1}ï¼š${p.a} Ã· ${p.b} = ${p.q} ã‚ã¾ã‚Š ${p.r}</div>`
    ).join("");

    elScore.textContent = "ç‚¹æ•°ï¼šâ€” / 100";
    elAnswers.style.display = "none";
    setPraise("", false);
    setCat(CAT.idle);
    startTimer();

    elQs.querySelectorAll("input").forEach(inp=>{
      inp.addEventListener("input", updateProgress);
      inp.addEventListener("keydown", (e)=>{
        if(e.key === "Enter"){
          const all = Array.from(elQs.querySelectorAll("input"));
          const idx = all.indexOf(e.target);
          if(idx >= 0 && idx+1 < all.length) all[idx+1].focus();
        }
      });
    });

    updateProgress();
  }

  function check() {
    const boxes = Array.from(document.querySelectorAll(".q"));
    const pointPer = 100 / QUESTION_COUNT;
    let score = 0;

    boxes.forEach((box, i) => {
      const qIn = box.querySelector(".ansQ");
      const rIn = box.querySelector(".ansR");
      const userQ = Number(qIn.value);
      const userR = Number(rIn.value);

      const ok = (qIn.value !== "" && rIn.value !== "" &&
                  userQ === problems[i].q && userR === problems[i].r);

      box.classList.remove("ok", "ng");
      box.classList.add(ok ? "ok" : "ng");
      box.querySelector(".status").textContent = ok ? "ã›ã„ã‹ã„ï¼â­" : "ã–ã‚“ã­ã‚“â€¦";
      if (ok) score += pointPer;
    });

    const s = Math.round(score);
    elScore.textContent = `ç‚¹æ•°ï¼š${s} / 100`;

    if (s === 100){
      setPraise("ã‹ã‚“ãºãï¼ï¼ ãœã‚“ã¶ã›ã„ã‹ã„ï¼ğŸ‰");
      setCat(CAT.perfect);
      popConfetti();
    } else if (s >= 90){
      setPraise("ã™ã”ã„ï¼ã‚‚ã†ã¡ã‚‡ã£ã¨ã§ã‹ã‚“ãºãï¼âœ¨");
      setCat(CAT.high);
      popConfetti();
    } else if (s >= 70){
      setPraise("ã„ã„ã­ï¼ã¾ã¡ãŒã„ã‚’ãªãŠã—ã¦ã¿ã‚ˆã†ï¼");
      setCat(CAT.midScore);
    } else {
      setPraise("ã ã„ã˜ã‚‡ã†ã¶ï¼ã‚†ã£ãã‚Šã‚„ã‚Œã°ã§ãã‚‹ã‚ˆï¼");
      setCat(CAT.low);
    }

    stopTimer();
    if (speedSel.value === "on" && startAt){
      timerEl.textContent = `â± ${formatTime(Date.now()-startAt)}ï¼ˆãŠã¤ã‹ã‚Œï¼ï¼‰`;
    }
  }

  document.getElementById("makeBtn").addEventListener("click", () => {
    applySettings();
    problems = generateProblems();
    render();
  });
  document.getElementById("checkBtn").addEventListener("click", check);
  document.getElementById("toggleAnsBtn").addEventListener("click", () => {
    elAnswers.style.display = (elAnswers.style.display === "none") ? "block" : "none";
  });
  document.getElementById("printBtn").addEventListener("click", () => window.print());

  [countSel, divSel, qSel, speedSel].forEach(el=>{
    el.addEventListener("change", ()=>{
      if(el === speedSel) startTimer();
    });
  });

  applySettings();
  problems = generateProblems();
  render();
</script>
</body>
</html>
