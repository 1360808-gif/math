<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>あまりのある わり算（3年生）</title>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;
  background:#f7f8ff;
}
.wrap{ max-width:1100px; margin:16px auto; padding:0 12px 40px; }

.top{
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:20px;
  padding:14px;
}
h1{ margin:0 0 10px; font-size:22px; }

/* ===== 上部1行 ===== */
.controlsRow{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:nowrap;
}

button{
  padding:8px 12px;
  border-radius:12px;
  border:1px solid #e5e7eb;
  background:#fff;
  font-weight:900;
  cursor:pointer;
}
button.primary{
  background:#4f46e5;
  color:#fff;
  border-color:transparent;
}

.timerInline{
  padding:6px 10px;
  border-radius:12px;
  border:1px solid #e5e7eb;
  background:#f8fafc;
  font-weight:900;
  white-space:nowrap;
}
.timerInline.running{
  border-color:#4f46e5;
  box-shadow:0 0 0 3px rgba(79,70,229,.15);
}

.timerHintInline{
  font-size:13px;
  font-weight:800;
  color:#6b7280;
  white-space:nowrap;
}

/* ===== 問題 ===== */
.grid{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}
.q{
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:16px;
  padding:12px;
}
.qRow{
  display:flex;
  align-items:center;
  gap:10px;
}
.expr{ font-size:18px; font-weight:1000; }

.answerBox{
  position:relative;
  display:inline-block;
}
.answerBox input{
  width:52px;
  text-align:center;
  font-size:16px;
  border-radius:10px;
  border:2px solid #e5e7eb;
  padding:4px;
}
.mark{
  position:absolute;
  top:50%;
  left:50%;
  width:44px;
  height:44px;
  border:4px solid rgba(239,68,68,.7);
  border-radius:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  display:none;
  z-index:10;
}
.answerBox.ok .mark{ display:block; }

.smallBtn{
  width:60px;
  height:36px;
  border-radius:12px;
  border:1px solid #e5e7eb;
  background:#fff;
  font-weight:900;
  font-size:12px;
  line-height:1.05;
}

/* ===== スコア ===== */
.score{
  margin-top:14px;
  font-weight:1000;
  font-size:18px;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <h1>あまりのある わり算（3年生）</h1>

    <!-- ★ 1行表示 -->
    <div class="controlsRow">
      <button class="primary" id="checkBtn">こたえあわせ</button>

      <div class="timerInline" id="timerBox">
        ⏱ <span id="timerText">0.0</span>びょう
      </div>

      <div class="timerHintInline" id="timerHint">
        「もんだいをつくる」でスタート／ぜんぶ せいかいでストップ！
      </div>

      <button id="makeBtn">もんだいをつくる</button>
    </div>
  </div>

  <div class="grid" id="qs"></div>
  <div class="score" id="score">点数：— / 100</div>

</div>

<script>
function rand(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
function toHalf(v){ return v.replace(/[０-９]/g,s=>String.fromCharCode(s.charCodeAt(0)-0xFEE0)); }

const QNUM=10;
let problems=[];

/* ===== タイマー ===== */
let tStart=null, tStop=null, tick=null;
const timerBox=document.getElementById("timerBox");
const timerText=document.getElementById("timerText");
const timerHint=document.getElementById("timerHint");

function timerReset(){
  tStart=null; tStop=null;
  timerText.textContent="0.0";
  timerBox.classList.remove("running");
}
function timerStart(){
  tStart=performance.now();
  timerBox.classList.add("running");
  tick=setInterval(()=>{
    if(!tStop) timerText.textContent=((performance.now()-tStart)/1000).toFixed(1);
  },100);
}
function timerStop(){
  if(tStop) return;
  tStop=performance.now();
  clearInterval(tick);
  timerBox.classList.remove("running");
}

function makeProblems(){
  const out=[];
  while(out.length<QNUM){
    const b=rand(2,9), q=rand(2,9), r=rand(1,b-1);
    out.push({a:b*q+r,b,q,r});
  }
  return out;
}

function render(){
  const qs=document.getElementById("qs");
  qs.innerHTML="";
  problems.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="q";
    d.innerHTML=`
      <div class="qRow">
        <span class="expr">${p.a} ÷ ${p.b} =</span>
        <span class="answerBox qBox">
          <input class="ansQ">
          <span class="mark"></span>
        </span>
        あまり
        <span class="answerBox rBox">
          <input class="ansR">
          <span class="mark"></span>
        </span>
        <button class="smallBtn">こたえを<br>みる</button>
      </div>
    `;
    qs.appendChild(d);

    const qI=d.querySelector(".ansQ");
    const rI=d.querySelector(".ansR");

    [qI,rI].forEach(inp=>{
      inp.addEventListener("input",()=>{
        inp.value=toHalf(inp.value);
        checkAllCorrect();
      });
    });
  });
}

function checkAllCorrect(){
  if(!tStart || tStop) return;
  const cards=[...document.querySelectorAll(".q")];
  for(let i=0;i<cards.length;i++){
    const uq=Number(cards[i].querySelector(".ansQ").value);
    const ur=Number(cards[i].querySelector(".ansR").value);
    if(uq!==problems[i].q || ur!==problems[i].r) return;
  }
  timerStop();
}

document.getElementById("makeBtn").onclick=()=>{
  problems=makeProblems();
  render();
  timerReset();
  timerStart();
};

document.getElementById("checkBtn").onclick=()=>{
  let score=0;
  document.querySelectorAll(".q").forEach((q,i)=>{
    const qb=q.querySelector(".qBox");
    const rb=q.querySelector(".rBox");
    qb.classList.toggle("ok",Number(q.querySelector(".ansQ").value)===problems[i].q);
    rb.classList.toggle("ok",Number(q.querySelector(".ansR").value)===problems[i].r);
    if(qb.classList.contains("ok")&&rb.classList.contains("ok")) score+=10;
  });
  document.getElementById("score").textContent=`点数：${score} / 100`;
  checkAllCorrect();
};

/* 初期表示 */
problems=makeProblems();
render();
</script>
</body>
</html>
